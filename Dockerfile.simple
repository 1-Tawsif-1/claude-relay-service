# ğŸ³ Hardcoded Factory.ai Relay - Zero Config Dockerfile
FROM node:18-alpine

# ğŸ“‹ è®¾ç½®æ ‡ç­¾
LABEL maintainer="factory-relay@example.com"
LABEL description="Hardcoded Factory.ai Relay Service - Zero Configuration"
LABEL version="1.0.0"

# ğŸ”§ å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apk add --no-cache \
    curl \
    dumb-init \
    && rm -rf /var/cache/apk/*

# ğŸ“ è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# ğŸ“¦ å¤åˆ¶ package æ–‡ä»¶
COPY package*.json ./

# ğŸ”½ å®‰è£…ä¾èµ– (ç”Ÿäº§ç¯å¢ƒ)
RUN npm ci --only=production && \
    npm cache clean --force

# ğŸ“‹ å¤åˆ¶åº”ç”¨ä»£ç 
COPY server-simple.js ./
COPY src/ ./src/
COPY public/ ./public/
COPY config/ ./config/

# ğŸ“ åˆ›å»ºå¿…è¦ç›®å½•
RUN mkdir -p logs data temp

# ğŸ”§ åˆ›å»º config.js (å¦‚æœä¸å­˜åœ¨)
RUN if [ ! -f "/app/config/config.js" ]; then \
        cp /app/config/config.example.js /app/config/config.js; \
    fi

# ğŸŒ æš´éœ²ç«¯å£
EXPOSE 3000

# ğŸ¥ å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:3000/health || exit 1

# âœ… æ— éœ€ç¯å¢ƒå˜é‡æ£€æŸ¥ï¼Œç›´æ¥å¯åŠ¨
# ğŸš€ å¯åŠ¨åº”ç”¨
ENTRYPOINT ["dumb-init", "--"]
CMD ["node", "server-simple.js"]
